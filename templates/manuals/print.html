<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ manual.title }} - å°åˆ·ç”¨</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/print.css') }}">
    <style>
        body {
            background: white;
            font-family: 'MS Gothic', 'MS Mincho', 'Hiragino Kaku Gothic Pro', sans-serif;
        }
        .print-only {
            display: block;
        }
        .no-print {
            display: none;
        }
        @media screen {
            .print-controls {
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 1000;
                background: white;
                padding: 10px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.2);
                border-radius: 4px;
            }
        }
        @media print {
            .print-controls {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- å°åˆ·ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
    <div class="print-controls no-print">
        <button onclick="window.print()" class="btn btn-primary">å°åˆ· / PDFä¿å­˜</button>
        <button onclick="window.close()" class="btn btn-outline">é–‰ã˜ã‚‹</button>
    </div>

    <div class="print-preview">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="print-header">
            <div class="print-title">{{ manual.title }}</div>
            <div class="print-info">
                <p>ä½œæˆè€…: {{ author.name }} | ä½œæˆæ—¥: {{ manual.created_at[:10] }} | æœ€çµ‚æ›´æ–°: {{ manual.updated_at[:10] }}</p>
            </div>
        </div>

        <!-- æ¦‚è¦ -->
        <div class="card">
            <h2 class="card-header">æ¦‚è¦</h2>
            <div style="padding: 5mm;">
                <p>{{ manual.description or 'èª¬æ˜ãªã—' }}</p>
                <div style="margin-top: 5mm;">
                    {% if manual.tags %}
                    <strong>ã‚¿ã‚°:</strong>
                    {% for tag in manual.tags.split(',') %}
                    <span class="badge badge-primary">{{ tag.strip() }}</span>
                    {% endfor %}
                    {% endif %}
                </div>
                <div style="margin-top: 3mm;">
                    <strong>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:</strong>
                    {% if manual.status == 'published' %}
                    <span class="badge badge-success">å…¬é–‹</span>
                    {% else %}
                    <span class="badge badge-secondary">ä¸‹æ›¸ã</span>
                    {% endif %}
                </div>
                <div style="margin-top: 3mm;">
                    <strong>å…¬é–‹ç¯„å›²:</strong>
                    {% if manual.visibility == 'public' %}å…¨ä½“å…¬é–‹
                    {% elif manual.visibility == 'department' %}éƒ¨ç½²å†…
                    {% else %}éå…¬é–‹{% endif %}
                </div>
            </div>
        </div>

        <!-- æ‰‹é † -->
        {% if steps %}
        <div class="card">
            <h2 class="card-header">æ‰‹é †</h2>
            <div style="padding: 5mm;">
                {% for step in steps %}
                <div class="step-item">
                    <div style="display: flex; align-items: center; margin-bottom: 3mm;">
                        <span class="step-number">{{ step.step_number }}</span>
                        <h3 style="margin: 0;">{{ step.title }}</h3>
                    </div>
                    <div style="white-space: pre-wrap; margin-left: 11mm;">{{ step.content }}</div>
                    
                    {% if step.notes %}
                    <div style="margin-top: 3mm; margin-left: 11mm; padding: 3mm; background-color: #f9f9f9; border-left: 3px solid #000; border-radius: 2px;">
                        <strong>ğŸ“ å‚™è€ƒ:</strong>
                        <div style="white-space: pre-wrap; margin-top: 2mm;">{{ step.notes }}</div>
                    </div>
                    {% endif %}
                    
                    {% if step.image_path %}
                    <div style="margin-top: 3mm; margin-left: 11mm;">
                        <img src="{{ url_for('uploaded_file', filename=step.image_path) }}" alt="{{ step.title }}" class="step-image">
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
        <div class="print-footer no-print">
            <p>Manual Factory ã§ä½œæˆ | {{ now }}</p>
        </div>
    </div>

    <script>
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®å‡¦ç†
        window.addEventListener('load', function() {
            // å°åˆ·ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è‡ªå‹•è¡¨ç¤ºã™ã‚‹å ´åˆï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
            // window.print();
        });
    </script>
</body>
</html>
