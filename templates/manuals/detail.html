{% extends "base.html" %}

{% block title %}{{ manual.title }} - Manual Factory{% endblock %}

{% block content %}
<div class="flex justify-between items-center mb-3">
    <div>
        <h1>{{ manual.title }}</h1>
        <div class="flex items-center gap-2 mt-2">
            {% if manual.status == 'published' %}
            <span class="badge badge-success">å…¬é–‹</span>
            {% else %}
            <span class="badge badge-secondary">ä¸‹æ›¸ã</span>
            {% endif %}
            
            {% if manual.tags %}
            {% for tag in manual.tags.split(',') %}
            <span class="badge badge-primary">{{ tag.strip() }}</span>
            {% endfor %}
            {% endif %}
        </div>
    </div>
    
    <div class="btn-group">
        <a href="{{ url_for('manual_print', manual_id=manual.id) }}" class="btn btn-outline" target="_blank">ğŸ“„ PDFå‡ºåŠ›</a>
        {% if manual.author_id == current_user.id or is_admin %}
        <a href="{{ url_for('manual_edit', manual_id=manual.id) }}" class="btn btn-primary">ç·¨é›†</a>
        <form method="POST" action="{{ url_for('manual_delete', manual_id=manual.id) }}" style="display: inline;" onsubmit="return confirmDelete()">
            <button type="submit" class="btn btn-danger">å‰Šé™¤</button>
        </form>
        {% endif %}
    </div>
</div>

<div class="card mb-3">
    <h2 class="card-header">æ¦‚è¦</h2>
    <p>{{ manual.description or 'èª¬æ˜ãªã—' }}</p>
    <div class="mt-2" style="color: var(--text-secondary); font-size: 0.875rem;">
        <p>ä½œæˆè€…: {{ author.name }}</p>
        <p>ä½œæˆæ—¥: {{ manual.created_at }}</p>
        <p>æœ€çµ‚æ›´æ–°: {{ manual.updated_at }}</p>
        <p>é–²è¦§æ•°: {{ access_count }}</p>
    </div>
</div>

{% if steps %}
<div class="card mb-3">
    <h2 class="card-header">æ‰‹é †</h2>
    {% for step in steps %}
    <div class="step-item">
        <div class="flex items-center mb-2">
            <span class="step-number">{{ step.step_number }}</span>
            <h3 style="margin: 0;">{{ step.title }}</h3>
        </div>
        <div style="white-space: pre-wrap;">{{ step.content }}</div>
        {% if step.notes %}
        <div style="margin-top: 1rem; padding: 0.75rem; background-color: var(--background); border-left: 3px solid var(--primary-color); border-radius: 0.375rem;">
            <strong style="color: var(--primary-color);">ğŸ“ å‚™è€ƒ:</strong>
            <div style="white-space: pre-wrap; margin-top: 0.5rem;">{{ step.notes }}</div>
        </div>
        {% endif %}
        {% if step.image_path %}
        <img src="{{ url_for('uploaded_file', filename=step.image_path) }}" alt="{{ step.title }}" class="step-image">
        {% endif %}
    </div>
    {% endfor %}
</div>
{% else %}
<div class="card text-center">
    <p>æ‰‹é †ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
</div>
{% endif %}

{% if history %}
<div class="card">
    <h2 class="card-header">æ›´æ–°å±¥æ­´</h2>
    <table class="table">
        <thead>
            <tr>
                <th>æ—¥æ™‚</th>
                <th>ãƒ¦ãƒ¼ã‚¶ãƒ¼</th>
                <th>æ“ä½œ</th>
            </tr>
        </thead>
        <tbody>
            {% for h in history %}
            <tr>
                <td>{{ h.created_at }}</td>
                <td>{{ h.user_name }}</td>
                <td>{{ h.action }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

{% endblock %}
